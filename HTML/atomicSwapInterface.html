<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Title  -->
  <title>PiNode-XMR - Atomic Swaps</title>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">  
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <!-- Load Ajax -->
  <script src="assets/js/jquery.min.js"></script>
  <link rel="shortcut icon" type="image/x-icon" href="assets/images/XMR.ico" />
  <!-- Font Awesome cdn -->
  <link rel="stylesheet" href="assets/css/fontawesome.css">
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">



  <!-- Custom Style Sheet -->
  <!-- CSS Styles wil be hosted in main project Sytle Sheet once implemented. -->
  <!-- <link rel="stylesheet" type="text/css" href="assets/css/app.css"> -->
<style>
  body {
	padding-top: 80px;
}
  .container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
}

.card {
    border: 1px solid #ddd;
    border-radius: 5px;
    padding: 20px;
    width: 80%;
    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
    background-color: #fff;
}

.card h2 {
    font-size: 20px;
    margin: 0;
}

.card p {
    margin: 10px 0;
}

.btn {
    margin: 10px 0;
    margin-left: 20%;
    width: 60%;
}

/* Remove up/down arrows on number box's */
input::-webkit-outer-spin-button,
input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
</style>
</head>

<!-- <body onload="fetchData();setInterval(fetchData, 20000);renderData();setInterval(renderData, 20000);"> -->
<body>
  <nav class="navbar navbar-expand-md navbar-light bg-light fixed-top">
    <a class="navbar-brand" href="index.html"><i class="fab fa-monero"></i> PiNode-XMR</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav justify-content-around w-100">
        <li class="nav-item">
          <a class="nav-link" href="nodeStatus.html"><i class="fas fa-info"></i> Node Status</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="nodeControl.html"><i class="fas fa-cogs"></i> Node Control</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/" target="_blank" onclick="javascript:event.target.port=4200;event.target.protocol='https:';">
            <i class="fas fa-terminal"></i> Web Terminal</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="explorer.html"><i class="fas fa-search-dollar"></i> Block Explorer</a>
        </li>        
        <li class="nav-item">
          <a class="nav-link" href="p2Pool.html"><i class="fas fa-comment-dollar"></i> P2Pool</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="i2p.html"><i class="fas fa-network-wired"></i> I2P</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="ethAtomicSwap.html"><i class="fas fa-arrows-rotate"></i> Swap</a>
        </li>        
        <li class="nav-item">
          <a class="nav-link" href="log.html"><i class="fas fa-database"></i> Logs</a>
        </li>
      </ul>
    </div>
  </nav>


  <div class="container-fluid">
    <div class="row">
      <div class="mx-auto" id="xmr-banner-container">
        <img class="img-fluid d-block" id="xmr-banner" src="assets/images/pinode-xmr-banner.png" srcset="assets/images/pinode-xmr-banner@2x.png 2x" />
      </div>
    </div>

    <div class="row">
      <div class="col">
        <h2 class="text-center">
          <small>Private Dependable Nodes</small>
        </h2>
        <hr>
      </div> <!-- col -->
    </div> <!-- row -->
  </div> <!-- container-fluid -->

  <div class="container">
    <div class="row my-4">
      <div class="col-md-12">

        <h2 class="font-weight-bold">Athanor Labs <small>Atomic Swaps</small></h2>

        <p><span>This is an implementation of ETH-XMR atomic swaps, <b>currently in BETA!</b> some bugs may exist. This tool is courtesy of AthanorLabs and <a href="https://github.com/AthanorLabs/atomic-swap/blob/master/docs/mainnet.md" target="_blank">their manual for mainnet commands are here</a></span>.</p>
        <p><span>This utility has been tested by a small group of developers and users and has their trust. This Atomic Swap utility is offered to PiNodeXMR users with their understanding that funds used here are at risk. If you experience a bug, error, loss of funds, or unexpected behaviour of the swap contract, please download both Atomic Swap log files from the logs Web-UI page and submit a report as an issue with description at their GitHub <a href="https://github.com/AthanorLabs/atomic-swap/issues" target="_blank">here</a>. PiNodeXMR is just a compilation project offering you these tools. I have no control over the Atomic Swap code/usage and as such cannot help when things go wrong with the exception of installation issues.</p>
        <p><span>Through our use and reporting this utility will grow.</span>.</p>
        <p><span>As further development takes place this Web-UI will become available to make+take XMR offers, as of Jan '24 this is still in the pipeline and will continue to develop.</span>.</p>
        <p><span>For now, find an offer below, check and double check available quantities and exchange rate. Trade interaction is done via the terminal 'Setup Menu -> Atomic Swaps' for both making and taking offers. This page may make copy/pasting trade configurations easier. Enjoy and safe trading.</span>.</p>

            <hr>

        <h2 class="font-weight-bold">Available Offers <small>ETH-XMR Atomic Swaps</small></h2>
        <p>Offers data refreshes in: <span id="timer"></span></p>
        
      </div> <!-- col -->
    </div> <!-- row -->
  </div> <!-- /container -->
</div>

<div class="container">
    <!-- Offers cards will be rendered here -->
</div>

<hr>

<div class="container">
    <div class="row my-4">
      <div class="col-md-12">

        <div><h5>Athanor Labs</h5> <small>GPLv3 Disclaimer:
            THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW. EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU. SHOULD THE PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING, REPAIR OR CORRECTION.
            
            IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MODIFIES AND/OR CONVEYS THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.</small></h2>
          </div>
          

      </div> <!-- col -->
    </div> <!-- row -->
  </div> <!-- /container -->

<script>
// Function to fetch data from the API
async function fetchData() {
    try {
        const response = await fetch('api/atomicSwap/queryAll.json');
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Error fetching data:', error);
    }
}

// Function to render data in cards
async function renderData() {
    const container = document.querySelector('.container');
    const data = await fetchData();

    if (!data) {
        return;
    }

    data.forEach(item => {
        const card = document.createElement('div');
        card.classList.add('card');

        const _peerID = document.createElement('h2');
        _peerID.textContent = 'Offer from peer: ' + item.peerID;

        const _offerID = document.createElement('p');
        _offerID.textContent = 'Offer ID: ' + item.offerID;

        const _provides = document.createElement('p');
        _provides.textContent = 'Provides: ' + item.provides;

        const _minAmount = document.createElement('p');
        _minAmount.textContent = 'Min Qty: ' + item.minAmount + ' XMR';

        const _maxAmount = document.createElement('p');
        _maxAmount.textContent = 'Max Qty: ' + item.maxAmount + ' XMR';

        const _exchangeRate = document.createElement('p');
        _exchangeRate.textContent = 'Exchange Rate: ' + item.exchangeRate + ' Eth to 1 XMR';

        const _ethAsset = document.createElement('p');
        _ethAsset.textContent = 'Eth Asset: ' + item.ethAsset;

        // Create 'Take Offer button' -- currently not functional
        // const _btn = document.createElement('button');
        // _btn.id = 'btn_id'
        // _btn.innerText = "Take Offer";
        // _btn.className += 'btn btn-block btn-lg btn-dark';


        // Create 'number box' element for take user swap qty.
        const _takeQty = document.createElement('input');
        _takeQty.setAttribute("type", "number");
        _takeQty.className += 'btn btn-block btn-light';
        _takeQty.setAttribute("placeholder", "Enter quantity of ETH to provide to this swap contract");
        _takeQty.addEventListener("change", (event) => {
          if ( event.target.value < (item.minAmount * item.exchangeRate)){ // Check value of Eth above or equal market makers minimum XMR value
            alert("You must send ETH value greater than or equal to swap providers XMR minimum")
          } else if (event.target.value > (item.maxAmount * item.exchangeRate)){ // Check value of Eth below or equal market makers maximum XMR value !Throwing complaint if sum is equal? Unexpected!
            alert("You must send ETH value less than or equal to swap providers XMR maximum")
          } else {
            _takeQty.value = event.target.value;
          const expectedXMR = event.target.value / item.exchangeRate
          if (confirm('Offer Review:\nAt exchange rate of ' + item.exchangeRate + '\nYou providing ' + _takeQty.value + 'ETH will result in you receiving ' + expectedXMR + 'XMR')) {
          //If user say 'yes' to confirm
          console.log('Swap is confirmed - Step 1');
              if (confirm('Are you Really really sure?')) {
              console.log('Swap is confirmed - Step 2');
              } else {
              //If user say 'no' and cancelled the action
              console.log('Swap is cancelled - Step 2');
              }
              console.log(_takeQty.value)
          } else {
           //If user say 'no' and cancelled the action
           console.log('Swap is cancelled - step 1');
           }
            console.log(_takeQty.value)
          }
          });
        

        card.appendChild(_peerID);
        card.appendChild(_offerID);
        card.appendChild(_provides);
        card.appendChild(_minAmount);
        card.appendChild(_maxAmount);
        card.appendChild(_exchangeRate);
        card.appendChild(_ethAsset);
        card.appendChild(_takeQty);
        // card.appendChild(_btn);
        container.appendChild(card);
    });

    var count=120;

    var counter=setInterval(timer, 1000);
    function timer()
    {
      count=count-1;
      if (count <= 0)
      {
        clearInterval(counter);
        return;
      }

      document.getElementById("timer").innerHTML=count + " secs";
    }

    setTimeout(function(){
   window.location.reload(true);
}, 120000);
}

// Call the renderData function to display data
renderData();
</script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>
</body>

</html>
